<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∏–±–µ—Ä –†–µ—à–µ–±–Ω–∏–∫</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Russo+One&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* --- –û–ë–©–ò–ô –°–¢–ò–õ–¨ --- */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            overflow-y: auto;
            background-color: #050510;
        }

        /* –§–æ–Ω */
        .background-image {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://images.unsplash.com/photo-1577017040065-65052831a153?q=80&w=2070&auto=format&fit=crop') no-repeat center center/cover;
            z-index: -2;
        }

        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω */
            z-index: -1;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ */
        .app-card {
            background: rgba(18, 18, 28, 0.95);
            border: 1px solid #00f3ff; /* –ì–æ–ª—É–±–∞—è —Ä–∞–º–∫–∞ */
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.15);
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 550px;
            position: relative;
            backdrop-filter: blur(10px);
        }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
        h1 {
            font-family: 'Russo One', sans-serif;
            text-align: center;
            color: #00f3ff;
            text-transform: uppercase;
            margin-top: 0;
            font-size: 2.2rem;
            text-shadow: 0 0 20px rgba(0, 243, 255, 0.8);
            letter-spacing: 2px;
        }

        .input-group { margin-bottom: 25px; }

        label {
            display: block;
            color: #bc13fe; /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
            font-weight: 800;
            margin-bottom: 10px;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ */
        input[type="text"] {
            width: 100%;
            padding: 15px;
            background: #0b0b14;
            border: 1px solid #333;
            color: #fff;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }
        input:focus { outline: none; border-color: #00f3ff; box-shadow: 0 0 15px rgba(0, 243, 255, 0.2); }

        /* --- –û–ë–õ–ê–°–¢–¨ –ó–ê–ì–†–£–ó–ö–ò (–ö–ê–ö –ù–ê –ö–ê–†–¢–ò–ù–ö–ï) --- */
        .file-area {
            border: 2px dashed #00f3ff; /* –ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è —Ä–∞–º–∫–∞ */
            background: rgba(0, 243, 255, 0.02);
            height: 180px; /* –í—ã—Å–æ—Ç–∞ –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ */
            border-radius: 15px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .file-area:hover {
            background: rgba(0, 243, 255, 0.08);
            box-shadow: inset 0 0 30px rgba(0, 243, 255, 0.1);
        }
        
        /* –¢–µ–∫—Å—Ç 1: –ù–ê–ñ–ú–ò–¢–ï –î–õ–Ø –í–´–ë–û–†–ê –§–ê–ô–õ–ê */
        .main-text { 
            font-size: 1.2rem; 
            color: #ffffff; 
            font-weight: 700;
            text-transform: uppercase;
            pointer-events: none; 
            margin-bottom: 10px;
            font-family: 'Montserrat', sans-serif;
        }
        
        /* –¢–µ–∫—Å—Ç 2: –ò–õ–ò –ù–ê–ñ–ú–ò–¢–ï CTRL + V */
        .paste-hint {
            font-size: 1rem;
            color: #00f3ff; /* –ì–æ–ª—É–±–æ–π –Ω–µ–æ–Ω */
            font-weight: 800;
            text-transform: uppercase;
            pointer-events: none;
            font-family: 'Russo One', sans-serif;
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }

        input[type="file"] { display: none; }

        #preview-img {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: contain; /* –ß—Ç–æ–±—ã —Ñ–æ—Ç–æ –≤–ª–µ–∑–∞–ª–æ —Ü–µ–ª–∏–∫–æ–º */
            background: #000;
            display: none;
        }

        /* –ö–Ω–æ–ø–∫–∞ */
        button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(90deg, #bc13fe, #00f3ff);
            border: none;
            color: white;
            font-family: 'Russo One', sans-serif;
            font-size: 1.3rem;
            cursor: pointer;
            border-radius: 10px;
            text-transform: uppercase;
            margin-top: 10px;
            letter-spacing: 1px;
            transition: 0.2s;
        }
        button:hover { transform: scale(1.02); box-shadow: 0 0 30px rgba(188, 19, 254, 0.6); }
        button:disabled { background: #444; cursor: not-allowed; transform: none; }

        /* –†–µ–∑—É–ª—å—Ç–∞—Ç */
        #result-container {
            margin-top: 25px;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            display: none;
            border-left: 4px solid #00f3ff;
        }

        .markdown-body { font-size: 1rem; line-height: 1.6; color: #e0e0e0; }
        code { background: #2a2a3d; padding: 2px 6px; border-radius: 4px; color: #00f3ff; }
        
        .loading-text {
            text-align: center;
            color: #00f3ff;
            font-family: 'Russo One', sans-serif;
            display: none;
            margin-top: 15px;
            animation: blink 1.5s infinite;
        }
        @keyframes blink { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }

        .reset-key {
            position: absolute; top: 15px; right: 15px;
            font-size: 0.7rem; color: #555; cursor: pointer;
        }
        .reset-key:hover { color: #888; }
    </style>
</head>
<body>

    <div class="background-image"></div>
    <div class="overlay"></div>

    <div class="app-card">
        <div class="reset-key" onclick="resetKey()">–°–±—Ä–æ—Å –∫–ª—é—á–∞</div>

        <h1>–ö–ò–ë–ï–† –†–ï–®–ï–ë–ù–ò–ö</h1>

        <div class="input-group">
            <label>üì∏ –§–û–¢–û –ó–ê–î–ê–ß–ò</label>
            
            <!-- –í–û–¢ –ó–î–ï–°–¨ –¢–ï–ö–°–¢ –¢–û–ß–ù–û –ö–ê–ö –í–´ –ü–†–û–°–ò–õ–ò -->
            <label class="file-area" id="drop-area" for="file-input">
                <img id="preview-img" src="">
                
                <span id="text-1" class="main-text">–ù–ê–ñ–ú–ò–¢–ï –î–õ–Ø –í–´–ë–û–†–ê –§–ê–ô–õ–ê</span>
                <span id="text-2" class="paste-hint">–ò–õ–ò –ù–ê–ñ–ú–ò–¢–ï CTRL + V</span>
                
                <input type="file" id="file-input" accept="image/*">
            </label>
        </div>

        <div class="input-group">
            <label>üí¨ –í–û–ü–†–û–° (–ù–ï–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)</label>
            <input type="text" id="user-prompt" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –æ–±—ä—è—Å–Ω–∏ —Ä–µ—à–µ–Ω–∏–µ...">
        </div>

        <button id="solve-btn" onclick="solveHomework()">–ó–ê–ü–£–°–¢–ò–¢–¨ –ê–ù–ê–õ–ò–ó</button>
        
        <div id="loading" class="loading-text">‚ö° –û–ë–†–ê–ë–û–¢–ö–ê –î–ê–ù–ù–´–•...</div>

        <div id="result-container">
            <div id="solution-content" class="markdown-body"></div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('file-input');
        const previewImg = document.getElementById('preview-img');
        const text1 = document.getElementById('text-1');
        const text2 = document.getElementById('text-2');
        let base64Image = "";

        // --- –õ–û–ì–ò–ö–ê –ö–õ–Æ–ß–ê ---
        function getApiKey() {
            let key = localStorage.getItem("openai_api_key");
            if (!key || key === "null" || key === "") {
                key = prompt("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à API –∫–ª—é—á OpenAI (–æ–¥–∏–Ω —Ä–∞–∑):");
                if (key) localStorage.setItem("openai_api_key", key.trim());
            }
            return key;
        }

        function resetKey() {
            localStorage.removeItem("openai_api_key");
            alert("–ö–ª—é—á —Å–±—Ä–æ—à–µ–Ω.");
        }

        // --- –û–ë–†–ê–ë–û–¢–ö–ê –§–ê–ô–õ–ê ---
        function handleFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                previewImg.style.display = 'block';
                // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç, –∫–æ–≥–¥–∞ —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
                text1.style.display = 'none';
                text2.style.display = 'none';
                base64Image = e.target.result.split(',')[1]; 
            }
            reader.readAsDataURL(file);
        }

        // 1. –ö–ª–∏–∫ –ø–æ –æ–±–ª–∞—Å—Ç–∏ (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ–≤–æ–¥–Ω–∏–∫)
        fileInput.addEventListener('change', function() {
            if (this.files[0]) handleFile(this.files[0]);
        });

        // 2. –í—Å—Ç–∞–≤–∫–∞ CTRL+V
        document.addEventListener('paste', function(event) {
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
            for (let index in items) {
                const item = items[index];
                if (item.kind === 'file' && item.type.includes('image/')) {
                    handleFile(item.getAsFile());
                }
            }
        });

        async function solveHomework() {
            const apiKey = getApiKey();
            if (!apiKey) {
                alert("–ù—É–∂–µ–Ω –∫–ª—é—á –¥–ª—è —Ä–∞–±–æ—Ç—ã.");
                return;
            }
            if (!base64Image) {
                alert("‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ (Ctrl+V) —Ñ–æ—Ç–æ!");
                return;
            }

            const userPrompt = document.getElementById('user-prompt').value;
            const resultContainer = document.getElementById('result-container');
            const solutionContent = document.getElementById('solution-content');
            const loading = document.getElementById('loading');
            const btn = document.getElementById('solve-btn');

            btn.disabled = true;
            btn.innerText = "–í–´–ß–ò–°–õ–ï–ù–ò–ï...";
            loading.style.display = 'block';
            resultContainer.style.display = 'none';

            const promptText = userPrompt ? userPrompt : "–†–µ—à–∏ –∑–∞–¥–∞—á—É —Å –∫–∞—Ä—Ç–∏–Ω–∫–∏. –†–∞—Å–ø–∏—à–∏ —Ä–µ—à–µ–Ω–∏–µ –ø–æ—à–∞–≥–æ–≤–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.";

            try {
                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "gpt-4o",
                        messages: [
                            { role: "system", content: "–¢—ã ‚Äî —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –†–µ—à–∞–π –∑–∞–¥–∞—á–∏ —á–µ—Ç–∫–æ. –ò—Å–ø–æ–ª—å–∑—É–π Markdown." },
                            {
                                role: "user",
                                content: [
                                    { type: "text", text: promptText },
                                    { type: "image_url", image_url: { url: `data:image/jpeg;base64,${base64Image}` } }
                                ]
                            }
                        ],
                        max_tokens: 1500
                    })
                });

                const data = await response.json();
                if (data.error) {
                    if (data.error.code === "invalid_api_key") {
                        localStorage.removeItem("openai_api_key");
                        throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á. –Ø —Å–±—Ä–æ—Å–∏–ª –µ–≥–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
                    }
                    throw new Error(data.error.message);
                }

                solutionContent.innerHTML = marked.parse(data.choices[0].message.content);
                resultContainer.style.display = 'block';

            } catch (error) {
                alert("–û—à–∏–±–∫–∞: " + error.message);
            } finally {
                loading.style.display = 'none';
                btn.disabled = false;
                btn.innerText = "–ó–ê–ü–£–°–¢–ò–¢–¨ –ê–ù–ê–õ–ò–ó";
            }
        }
    </script>

</body>
</html>
