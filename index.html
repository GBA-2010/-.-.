<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∏–±–µ—Ä –†–µ—à–µ–±–Ω–∏–∫ (Auto)</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Russo+One&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            overflow-y: auto;
        }

        .background-image {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://images.unsplash.com/photo-1577017040065-65052831a153?q=80&w=2070&auto=format&fit=crop') no-repeat center center/cover;
            z-index: -2;
        }

        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }

        .app-card {
            background: rgba(18, 18, 28, 0.95);
            border: 1px solid #00f3ff;
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.2);
            padding: 40px;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            position: relative;
            backdrop-filter: blur(5px);
        }

        h1 {
            font-family: 'Russo One', sans-serif;
            text-align: center;
            color: #00f3ff;
            text-transform: uppercase;
            margin-top: 0;
            font-size: 2rem;
            text-shadow: 0 0 15px rgba(0, 243, 255, 0.6);
        }

        .input-group { margin-bottom: 20px; }

        label {
            display: block;
            color: #bc13fe;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.95rem;
            text-transform: uppercase;
        }

        input[type="text"] {
            width: 100%;
            padding: 14px;
            background: #0b0b14;
            border: 1px solid #444;
            color: #fff;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        input:focus { outline: none; border-color: #00f3ff; }

        .file-area {
            border: 2px dashed #00f3ff;
            background: rgba(0, 243, 255, 0.03);
            padding: 25px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100px;
        }

        .file-area:hover { background: rgba(0, 243, 255, 0.1); }
        
        .file-area span { 
            font-size: 1rem; 
            color: #aaa; 
            pointer-events: none; 
        }
        
        .paste-hint {
            font-size: 0.8rem !important;
            color: #00f3ff !important;
            margin-top: 5px;
        }

        input[type="file"] { display: none; }

        #preview-img {
            max-width: 100%;
            max-height: 200px;
            margin-top: 15px;
            border-radius: 8px;
            display: none;
            border: 1px solid #555;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }

        button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(90deg, #bc13fe, #00f3ff);
            border: none;
            color: white;
            font-family: 'Russo One', sans-serif;
            font-size: 1.1rem;
            cursor: pointer;
            border-radius: 8px;
            text-transform: uppercase;
            margin-top: 10px;
        }

        button:hover { transform: translateY(-2px); box-shadow: 0 0 25px rgba(188, 19, 254, 0.5); }
        button:disabled { background: #444; cursor: not-allowed; }

        #result-container {
            margin-top: 25px;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            display: none;
            border-left: 4px solid #00f3ff;
        }

        .markdown-body { font-size: 1rem; line-height: 1.6; color: #e0e0e0; }
        code { background: #2a2a3d; padding: 2px 6px; border-radius: 4px; color: #00f3ff; }
        
        .loading-text {
            text-align: center;
            color: #00f3ff;
            font-family: 'Russo One', sans-serif;
            display: none;
            margin-top: 15px;
            animation: blink 1.5s infinite;
        }
        @keyframes blink { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }

        /* –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –∫–ª—é—á–∞ (–º–∞–ª–µ–Ω—å–∫–∞—è –≤ —É–≥–ª—É) */
        .reset-key {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.7rem;
            color: #555;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            width: auto;
            margin: 0;
            text-transform: none;
            font-family: sans-serif;
        }
        .reset-key:hover { color: #888; box-shadow: none; transform: none; }

    </style>
</head>
<body>

    <div class="background-image"></div>
    <div class="overlay"></div>

    <div class="app-card">
        <!-- –°–∫—Ä—ã—Ç–∞—è –∫–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞, –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –≤–≤–µ–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á -->
        <div class="reset-key" onclick="resetKey()">–°–±—Ä–æ—Å –∫–ª—é—á–∞</div>

        <h1>–ö–ò–ë–ï–† –†–ï–®–ï–ë–ù–ò–ö</h1>

        <div class="input-group">
            <label>üì∏ –§–û–¢–û –ó–ê–î–ê–ß–ò</label>
            <label class="file-area" id="drop-area" for="file-input">
                <span id="file-text">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</span>
                <span id="paste-text" class="paste-hint">–ò–õ–ò –ù–ê–ñ–ú–ò–¢–ï CTRL+V (–í–°–¢–ê–í–ò–¢–¨)</span>
                <input type="file" id="file-input" accept="image/*">
                <img id="preview-img" src="">
            </label>
        </div>

        <div class="input-group">
            <label>üí¨ –í–û–ü–†–û–° (–ù–ï–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)</label>
            <input type="text" id="user-prompt" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –æ–±—ä—è—Å–Ω–∏ —Ä–µ—à–µ–Ω–∏–µ...">
        </div>

        <button id="solve-btn" onclick="solveHomework()">–ó–ê–ü–£–°–¢–ò–¢–¨ –ê–ù–ê–õ–ò–ó</button>
        
        <div id="loading" class="loading-text">‚ö° –û–ë–†–ê–ë–û–¢–ö–ê –î–ê–ù–ù–´–•...</div>

        <div id="result-container">
            <div id="solution-content" class="markdown-body"></div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('file-input');
        const previewImg = document.getElementById('preview-img');
        const fileText = document.getElementById('file-text');
        const pasteText = document.getElementById('paste-text');
        let base64Image = "";

        // --- –õ–û–ì–ò–ö–ê –ö–õ–Æ–ß–ê (–°–ö–†–´–¢–ê–Ø) ---
        function getApiKey() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–ª—é—á –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞
            let key = localStorage.getItem("openai_api_key");
            
            // –ï—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ—Ç, —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –æ–¥–∏–Ω —Ä–∞–∑
            if (!key || key === "null" || key === "") {
                key = prompt("–î–ª—è —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è API –∫–ª—é—á OpenAI. –í–≤–µ–¥–∏—Ç–µ –µ–≥–æ –æ–¥–∏–Ω —Ä–∞–∑, –∏ —è –µ–≥–æ –∑–∞–ø–æ–º–Ω—é:");
                if (key) {
                    localStorage.setItem("openai_api_key", key.trim());
                }
            }
            return key;
        }

        function resetKey() {
            localStorage.removeItem("openai_api_key");
            alert("–ö–ª—é—á —Å–±—Ä–æ—à–µ–Ω. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ —Å–ø—Ä–æ—à—É —Å–Ω–æ–≤–∞.");
        }
        // -------------------------------

        function handleFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                previewImg.style.display = 'block';
                fileText.style.display = 'none';
                pasteText.style.display = 'none';
                base64Image = e.target.result.split(',')[1]; 
            }
            reader.readAsDataURL(file);
        }

        fileInput.addEventListener('change', function() {
            if (this.files[0]) handleFile(this.files[0]);
        });

        document.addEventListener('paste', function(event) {
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
            for (let index in items) {
                const item = items[index];
                if (item.kind === 'file' && item.type.includes('image/')) {
                    handleFile(item.getAsFile());
                }
            }
        });

        async function solveHomework() {
            // –ü–æ–ª—É—á–∞–µ–º –∫–ª—é—á –∏–∑ –ø–∞–º—è—Ç–∏ –∏–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ–º
            const apiKey = getApiKey();

            if (!apiKey) {
                alert("–ë–µ–∑ –∫–ª—é—á–∞ —è –Ω–µ —Å–º–æ–≥—É —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ò–ò. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
                return;
            }

            if (!base64Image) {
                alert("‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ (Ctrl+V) —Ñ–æ—Ç–æ!");
                return;
            }

            const userPrompt = document.getElementById('user-prompt').value;
            const resultContainer = document.getElementById('result-container');
            const solutionContent = document.getElementById('solution-content');
            const loading = document.getElementById('loading');
            const btn = document.getElementById('solve-btn');

            btn.disabled = true;
            btn.innerText = "–í–´–ß–ò–°–õ–ï–ù–ò–ï...";
            loading.style.display = 'block';
            resultContainer.style.display = 'none';

            const promptText = userPrompt ? userPrompt : "–†–µ—à–∏ –∑–∞–¥–∞—á—É —Å –∫–∞—Ä—Ç–∏–Ω–∫–∏. –†–∞—Å–ø–∏—à–∏ —Ä–µ—à–µ–Ω–∏–µ –ø–æ—à–∞–≥–æ–≤–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.";

            try {
                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "gpt-4o",
                        messages: [
                            {
                                role: "system",
                                content: "–¢—ã ‚Äî —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –†–µ—à–∞–π –∑–∞–¥–∞—á–∏ —á–µ—Ç–∫–æ. –ò—Å–ø–æ–ª—å–∑—É–π Markdown."
                            },
                            {
                                role: "user",
                                content: [
                                    { type: "text", text: promptText },
                                    {
                                        type: "image_url",
                                        image_url: {
                                            url: `data:image/jpeg;base64,${base64Image}`
                                        }
                                    }
                                ]
                            }
                        ],
                        max_tokens: 1500
                    })
                });

                const data = await response.json();

                if (data.error) {
                    // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –∫–ª—é—á–æ–º, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–±—Ä–æ—Å–∏—Ç—å –µ–≥–æ
                    if (data.error.code === "invalid_api_key") {
                        localStorage.removeItem("openai_api_key");
                        throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á. –Ø —É–¥–∞–ª–∏–ª –µ–≥–æ –∏–∑ –ø–∞–º—è—Ç–∏. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Å–Ω–æ–≤–∞ –∏ –≤–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π.");
                    }
                    throw new Error(data.error.message);
                }

                const markdownText = data.choices[0].message.content;
                solutionContent.innerHTML = marked.parse(markdownText);
                resultContainer.style.display = 'block';

            } catch (error) {
                alert("–û—à–∏–±–∫–∞: " + error.message);
            } finally {
                loading.style.display = 'none';
                btn.disabled = false;
                btn.innerText = "–ó–ê–ü–£–°–¢–ò–¢–¨ –ê–ù–ê–õ–ò–ó";
            }
        }
    </script>

</body>
</html>
