<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∏–±–µ—Ä –†–µ—à–µ–±–Ω–∏–∫ (Fix)</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Russo+One&display=swap" rel="stylesheet">
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>

    <style>
        /* --- –°–¢–ò–õ–ò --- */
        body {
            margin: 0; padding: 0;
            font-family: 'Montserrat', sans-serif;
            height: 100vh;
            display: flex; justify-content: center; align-items: center;
            color: white; overflow-y: auto;
            background-color: #050510;
        }
        .background-image {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://images.unsplash.com/photo-1577017040065-65052831a153?q=80&w=2070&auto=format&fit=crop') no-repeat center center/cover;
            z-index: -2;
        }
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); z-index: -1;
        }
        .app-card {
            background: rgba(18, 18, 28, 0.95);
            border: 1px solid #00f3ff;
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.15);
            padding: 40px; border-radius: 20px;
            width: 90%; max-width: 550px;
            position: relative; backdrop-filter: blur(10px);
        }
        h1 {
            font-family: 'Russo One', sans-serif; text-align: center;
            color: #00f3ff; text-transform: uppercase; margin-top: 0;
            font-size: 2.2rem; text-shadow: 0 0 20px rgba(0, 243, 255, 0.8);
        }
        .input-group { margin-bottom: 25px; }
        label {
            display: block; color: #bc13fe; font-weight: 800;
            margin-bottom: 10px; font-size: 1rem; text-transform: uppercase;
        }
        .file-area {
            border: 2px dashed #00f3ff; background: rgba(0, 243, 255, 0.02);
            height: 180px; border-radius: 15px; cursor: pointer;
            transition: 0.3s; display: flex; flex-direction: column;
            align-items: center; justify-content: center; position: relative; overflow: hidden;
        }
        .file-area:hover { background: rgba(0, 243, 255, 0.08); }
        .main-text { 
            font-size: 1.2rem; color: #ffffff; font-weight: 700;
            text-transform: uppercase; pointer-events: none; margin-bottom: 10px; z-index: 2;
        }
        .paste-hint {
            font-size: 1rem; color: #00f3ff; font-weight: 800;
            text-transform: uppercase; pointer-events: none; font-family: 'Russo One', sans-serif; z-index: 2;
        }
        input[type="file"] { display: none; }
        #preview-img {
            position: absolute; width: 100%; height: 100%; object-fit: contain;
            background: #000; display: none; z-index: 1; opacity: 0.6;
        }
        button {
            width: 100%; padding: 18px;
            background: linear-gradient(90deg, #bc13fe, #00f3ff);
            border: none; color: white; font-family: 'Russo One', sans-serif;
            font-size: 1.3rem; cursor: pointer; border-radius: 10px;
            text-transform: uppercase; margin-top: 10px; transition: 0.2s;
        }
        button:hover { transform: scale(1.02); box-shadow: 0 0 30px rgba(188, 19, 254, 0.6); }
        button:disabled { background: #444; cursor: not-allowed; transform: none; }
        #result-container {
            margin-top: 25px; background: rgba(255, 255, 255, 0.05);
            padding: 20px; border-radius: 10px; display: none; border-left: 4px solid #00f3ff;
        }
        .result-text { font-size: 1.2rem; line-height: 1.6; color: #fff; font-weight: bold; }
        .loading-text {
            text-align: center; color: #00f3ff; font-family: 'Russo One', sans-serif;
            display: none; margin-top: 15px; animation: blink 1.5s infinite;
        }
        @keyframes blink { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }
    </style>
</head>
<body>

    <div class="background-image"></div>
    <div class="overlay"></div>

    <div class="app-card">
        <h1>–ö–ò–ë–ï–† –†–ï–®–ï–ë–ù–ò–ö</h1>

        <div class="input-group">
            <label>üì∏ –§–û–¢–û –ü–†–ò–ú–ï–†–ê</label>
            <label class="file-area" id="drop-area" for="file-input">
                <img id="preview-img" src="">
                <span id="text-1" class="main-text">–ù–ê–ñ–ú–ò–¢–ï –î–õ–Ø –í–´–ë–û–†–ê –§–ê–ô–õ–ê</span>
                <span id="text-2" class="paste-hint">–ò–õ–ò –ù–ê–ñ–ú–ò–¢–ï CTRL + V</span>
                <input type="file" id="file-input" accept="image/*">
            </label>
        </div>

        <button id="solve-btn" onclick="solveHomework()">–ó–ê–ü–£–°–¢–ò–¢–¨ –ê–ù–ê–õ–ò–ó</button>
        
        <div id="loading" class="loading-text">‚ö° –ò–©–£ –¶–ò–§–†–´ –ò –†–ï–®–ê–Æ...</div>

        <div id="result-container">
            <div id="solution-content" class="result-text"></div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('file-input');
        const previewImg = document.getElementById('preview-img');
        const text1 = document.getElementById('text-1');
        const text2 = document.getElementById('text-2');
        let currentFile = null;

        function handleFile(file) {
            currentFile = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                previewImg.style.display = 'block';
                text1.style.display = 'none';
                text2.style.display = 'none';
            }
            reader.readAsDataURL(file);
        }

        fileInput.addEventListener('change', function() {
            if (this.files[0]) handleFile(this.files[0]);
        });

        document.addEventListener('paste', function(event) {
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
            for (let index in items) {
                const item = items[index];
                if (item.kind === 'file' && item.type.includes('image/')) {
                    handleFile(item.getAsFile());
                }
            }
        });

        async function solveHomework() {
            if (!currentFile) {
                alert("‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ!");
                return;
            }

            const resultContainer = document.getElementById('result-container');
            const solutionContent = document.getElementById('solution-content');
            const loading = document.getElementById('loading');
            const btn = document.getElementById('solve-btn');

            btn.disabled = true;
            loading.style.display = 'block';
            resultContainer.style.display = 'none';
            solutionContent.innerText = "";

            try {
                // 1. –†–∞—Å–ø–æ–∑–Ω–∞–µ–º —Ç–µ–∫—Å—Ç (–ø–æ–¥–∫–ª—é—á–∞–µ–º —Ä—É—Å—Å–∫–∏–π –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
                const { data: { text } } = await Tesseract.recognize(
                    currentFile,
                    'eng+rus', 
                    { logger: m => console.log(m) }
                );

                console.log("–°—ã—Ä–æ–π —Ç–µ–∫—Å—Ç:", text);

                // 2. –ñ–ï–°–¢–ö–ê–Ø –û–ß–ò–°–¢–ö–ê: –£–¥–∞–ª—è–µ–º –í–°–ï –±—É–∫–≤—ã. –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ –∑–Ω–∞–∫–∏.
                // –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –æ—à–∏–±–∫—É "Undefined symbol Kakue..."
                let mathExpression = text.replace(/[^0-9\+\-\*\/\(\)\.\,]/g, '');
                
                // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É (–¥–ª—è –¥—Ä–æ–±–µ–π)
                mathExpression = mathExpression.replace(/,/g, '.');

                console.log("–û—á–∏—â–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä:", mathExpression);

                if (!mathExpression || mathExpression.length < 1) {
                    throw new Error("–ù–∞ —Ñ–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ü–∏—Ñ—Ä –∏–ª–∏ –ø—Ä–∏–º–µ—Ä–æ–≤.");
                }

                // 3. –ü—ã—Ç–∞–µ–º—Å—è —Ä–µ—à–∏—Ç—å
                const result = math.evaluate(mathExpression);

                // 4. –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                solutionContent.innerHTML = `
                    <div style="font-size: 0.9rem; color: #aaa;">–Ø –Ω–∞—à–µ–ª –ø—Ä–∏–º–µ—Ä: ${mathExpression}</div>
                    <br>
                    <span style="color: #00f3ff; font-size: 1.8em; text-shadow: 0 0 10px #00f3ff;">–û–¢–í–ï–¢: ${result}</span>
                `;
                resultContainer.style.display = 'block';

            } catch (error) {
                // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–ª—É—á–∏–ª–∞—Å—å, –ø–∏—à–µ–º –ø–æ–Ω—è—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç
                let errorMsg = "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–µ—à–∏—Ç—å.";
                if (error.message.includes("Undefined symbol")) {
                    errorMsg = "–ù–∞ —Ñ–æ—Ç–æ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞. –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º —Ä–µ—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã (2+2).";
                } else {
                    errorMsg = error.message;
                }

                solutionContent.innerHTML = `
                    <span style="color: #ff4444; font-size: 1.1rem;">
                    ‚õî ${errorMsg}
                    <br><br>
                    <small style="color: #ccc">–°–æ–≤–µ—Ç: –û–±—Ä–µ–∂—å—Ç–µ —Ñ–æ—Ç–æ —Ç–∞–∫, —á—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä (–±–µ–∑ —Å–ª–æ–≤).</small>
                    </span>`;
                resultContainer.style.display = 'block';
            } finally {
                loading.style.display = 'none';
                btn.disabled = false;
            }
        }
    </script>

</body>
</html>
